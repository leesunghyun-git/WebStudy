<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.replyboard-mapper">
<!-- 
	private int no,hit,group_id,group_step,group_tab,root,depth;
	private String name,subject,content,pwd,dbday;
	private Date regdate;
	
		group_tab   : 간격 조절
			AAAA 0
			  => BBBB 0
			     => CCCC 2
		group_id    : 답변을 모아 둔것
			AAAAA  1
				=> BBBBB 1
 				  => CCCCCC 1
				 => DDDDD 1
			EEEEE 2
			  => KKKK 2
		group_step
			AAAAA 0
				=> BBBBB 1
					=> CCCCC 2
				=> DDDDD 3
			
			AAAAA				1   0   0
			  => BBBBB			1   1
			  	=> CCCCCC		1   2
			  => DDDDD 			1   1

 -->
	<select id="boardListData" resultType="ReplyBoardVO" parameterType="int">
		SELECT no,subject,name,TO_CHAR(regdate,'YYYY-MM-DD') as dbday,hit,group_tab
		FROM replyboard
		ORDER BY group_id DESC , group_step asc
		OFFSET #{start} ROWS FETCH NEXT 10 ROWS ONLY
	</select>
	<select id="boardTotalPage" resultType="int">
		SELECT COUNT(*)
		FROM replyboard
	</select>
	<insert id="boardInsert" parameterType="ReplyBoardVO">
		INSERT INTO replyboard(no,subject,name,pwd,content,group_id) 
		VALUES(rb_no_seq.nextval,#{subject},#{name},#{pwd},#{content},
		(SELECT NVL(MAX(group_id)+1,1)
		FROM replyboard)) 
	</insert>
	<select id="boardNewdetail" resultType="int">
		SELECT MAX(no) FROM replyboard
	</select>
	<select id="boardDetail" resultType="ReplyBoardVO" parameterType="int">
		SELECT no,hit,name,subject,content,TO_CHAR(regdate,'YYYY-MM-DD') as dbday
		FROM replyboard
		WHERE no = #{no}
	</select>
	<update id="boardHitIncrement" parameterType="int">
		UPDATE replyboard
		SET hit = hit+1
		WHERE no=#{no}
	</update>
	<select id="boardPwdCheck" resultType="string" parameterType="int">
		SELECT pwd
		FROM replyboard
		WHERE no=#{no}
	</select>
	<select id="boardUpdateData" resultType="ReplyBoardVO" parameterType="int">
		SELECT no,name,subject,content
		FROM replyboard
		WHERE no=#{no}
	</select>
	<update id="boardUpdate" parameterType="ReplyBoardVO">
		UPDATE replyboard
		SET name = #{name}, subject=#{subject},content=#{content}
		WHERE no=#{no}
	</update>
	<!-- 답변하기 -->
	<!-- 1. 답변 대상의 group_id group_step group_tab -->
	<!-- 
							gi 	  	gs	   gt
			AAAAAA		    1		0		0
			  => BBBBBBB	1		1		1	
			     => CCCCC	1		2		2
			  => DDDDDD		1		3		1
			  
	
	 -->
	 <select id="boardParentInfoData" resultType="ReplyBoardVO" parameterType="int">
	 	SELECT group_id, group_step, group_tab
	 	FROM replyboard
	 	WHERE no=#{pno}
	 </select>
	 <!-- 
	 		UPDATE 설정
	 		
	 		AAAAAAA
	 		   => BBBBBB
	 		     => CCCCCC
	  -->
	  <update id="boardGroupStepIncrement" parameterType="ReplyBoardVO">
	  	UPDATE replyboard SET
	  	group_step=group_step+1
	  	WHERE group_id=#{group_id} AND group_step>#{group_step}  
	  
	  </update>
	  <!-- 
	  		INSERT
	   -->
	   <insert id="boardReplyInsert" parameterType="ReplyBoardVO">
	   	INSERT INTO replyboard(no,name,subject,content,pwd,group_id,group_step,group_tab,root,depth)
	   	VALUES(rb_no_seq.nextval,#{name},#{subject},#{content},#{pwd},#{group_id},#{group_step},#{group_tab},#{root},0)
	   </insert>
	   <!-- 
	   		UPDATE	
	    -->
	    <update id="boardDepthIncrement" parameterType="int">
	    	UPDATE replyboard SET
	    	depth = depth+1
	    	WHERE no=#{no}
	    </update>
	<!-- 삭제 하기 -->
	<select id="boardDeleteInfoData" resultType="ReplyBoardVO" parameterType="int">
		SELECT pwd,depth,root
		FROM replyboard
		WHERE no=#{no}
	
	</select>
	<update id="boardSCData" parameterType="int">
		UPDATE replyboard SET
		subject='관리자가 삭제한 게시물입니다.' , content=#{관리자가 삭제한 게시물입니다.}
		WHERE no=#{no}
	</update>
	<delete id="boardDelete" parameterType="int">
		DELETE FROM replyboard
		WHERE no=#{no}
	</delete>
	<update id="boardDepthDecrement" parameterType="int">
		UPDATE replyboard SET
		depth=depth-1
		WHERE no=#{no}
	</update>
</mapper>